{% extends "base.html" %}

{% block title %}Gesti√≥n de Aulas y Profesores{% endblock %}

{% block extra_css %}
<style>
    body {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        color: white;
        min-height: 100vh;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 40px 20px;
    }

    .page-header {
        text-align: center;
        margin-bottom: 40px;
    }

    .page-header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
    }

    .tabs {
        display: flex;
        gap: 12px;
        margin-bottom: 30px;
        border-bottom: 2px solid rgba(255,255,255,0.1);
    }

    .tab {
        padding: 16px 32px;
        background: transparent;
        border: none;
        color: #94a3b8;
        cursor: pointer;
        font-weight: 600;
        border-bottom: 3px solid transparent;
        transition: all 0.3s;
    }

    .tab.active {
        color: #3b82f6;
        border-bottom-color: #3b82f6;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
        animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
    }

    .card {
        background: rgba(255,255,255,0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 16px;
        padding: 30px;
    }

    .card h2 {
        margin-top: 0;
        margin-bottom: 24px;
        font-size: 1.5rem;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #94a3b8;
        font-weight: 600;
    }

    .form-group input,
    .form-group select {
        width: 100%;
        padding: 12px 16px;
        background: rgba(255,255,255,0.05);
        border: 2px solid rgba(255,255,255,0.1);
        border-radius: 8px;
        color: white;
        font-size: 1rem;
    }

    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: #3b82f6;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }

    .checkbox-group {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
    }

    .checkbox-group input[type="checkbox"] {
        width: 20px;
        height: 20px;
    }

    .btn {
        padding: 14px 32px;
        border: none;
        border-radius: 8px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 1rem;
    }

    .btn-primary {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
    }

    .btn-secondary {
        background: rgba(255,255,255,0.1);
        color: white;
    }

    .btn-secondary:hover {
        background: rgba(255,255,255,0.15);
    }

    .table-container {
        overflow-x: auto;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    table thead {
        background: rgba(59, 130, 246, 0.2);
    }

    table th,
    table td {
        padding: 14px;
        text-align: left;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    table th {
        font-weight: 700;
        color: #3b82f6;
    }

    table tr:hover {
        background: rgba(255,255,255,0.03);
    }

    .badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .badge-success {
        background: rgba(16, 185, 129, 0.2);
        color: #10b981;
    }

    .badge-warning {
        background: rgba(245, 158, 11, 0.2);
        color: #f59e0b;
    }

    .badge-danger {
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
    }

    .action-btns {
        display: flex;
        gap: 8px;
    }

    .btn-icon {
        padding: 8px 12px;
        background: rgba(255,255,255,0.05);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 6px;
        color: white;
        cursor: pointer;
        transition: all 0.3s;
    }

    .btn-icon:hover {
        background: rgba(59, 130, 246, 0.2);
        border-color: #3b82f6;
    }

    .stats-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: rgba(59, 130, 246, 0.1);
        border: 1px solid rgba(59, 130, 246, 0.3);
        border-radius: 12px;
        padding: 20px;
        text-align: center;
    }

    .stat-value {
        font-size: 2.5rem;
        font-weight: bold;
        color: #3b82f6;
        margin-bottom: 8px;
    }

    .stat-label {
        color: #94a3b8;
        font-size: 0.9rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    
    <div class="page-header">
        <h1>üè´ Gesti√≥n de Aulas y Profesores</h1>
        <p style="color: #94a3b8;">Configuraci√≥n para el proceso de admisi√≥n</p>
    </div>

    <!-- TABS -->
    <div class="tabs">
        <button class="tab active" onclick="cambiarTab('aulas')">üè´ Aulas</button>
        <button class="tab" onclick="cambiarTab('profesores')">üë®‚Äçüè´ Profesores</button>
    </div>

    <!-- TAB: AULAS -->
    <div id="tab-aulas" class="tab-content active">
        
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-value" id="totalAulas">0</div>
                <div class="stat-label">Total Aulas</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="capacidadTotal">0</div>
                <div class="stat-label">Capacidad Total</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="aulasActivas">0</div>
                <div class="stat-label">Aulas Activas</div>
            </div>
        </div>

        <div class="grid-2">
            <!-- Formulario Registrar Aula -->
            <div class="card">
                <h2>‚ûï Registrar Nueva Aula</h2>
                <form id="formAula" onsubmit="registrarAula(event)">
                    
                    <div class="form-group">
                        <label>C√≥digo de Aula *</label>
                        <input type="text" name="codigo_aula" required 
                               placeholder="Ej: A-101">
                    </div>

                    <div class="form-group">
                        <label>Nombre del Aula *</label>
                        <input type="text" name="nombre" required 
                               placeholder="Ej: Aula Magna">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Piso *</label>
                            <input type="number" name="piso" required min="1" max="10">
                        </div>

                        <div class="form-group">
                            <label>Edificio</label>
                            <input type="text" name="edificio" 
                                   placeholder="Ej: Edificio Principal">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Capacidad M√°xima *</label>
                        <input type="number" name="capacidad_maxima" required 
                               min="10" max="100" value="30">
                    </div>

                    <div class="form-group">
                        <label>Proceso de Admisi√≥n</label>
                        <select name="proceso_admision">
                            <option value="ADMISION_2025_2">ADMISI√ìN 2025-2</option>
                            <option value="ADMISION_2025_1">ADMISI√ìN 2025-1</option>
                        </select>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" name="tiene_rampa" id="tiene_rampa">
                        <label for="tiene_rampa">Tiene rampa de acceso</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" name="tiene_ascensor" id="tiene_ascensor">
                        <label for="tiene_ascensor">Tiene ascensor</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" name="piso_accesible" id="piso_accesible" checked>
                        <label for="piso_accesible">Piso accesible</label>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Registrar Aula
                    </button>
                </form>
            </div>

            <!-- Lista de Aulas -->
            <div class="card">
                <h2>üìã Aulas Registradas</h2>
                <div class="table-container">
                    <table id="tablaAulas">
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Nombre</th>
                                <th>Ubicaci√≥n</th>
                                <th>Capacidad</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="listaAulas">
                            <tr>
                                <td colspan="6" style="text-align: center; color: #94a3b8;">
                                    Cargando...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB: PROFESORES -->
    <div id="tab-profesores" class="tab-content">
        
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-value" id="totalProfesores">0</div>
                <div class="stat-label">Total Profesores</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="profesoresActivos">0</div>
                <div class="stat-label">Activos</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="profesoresAsignados">0</div>
                <div class="stat-label">Con Aulas Asignadas</div>
            </div>
        </div>

        <div class="grid-2">
            <!-- Formulario Registrar Profesor -->
            <div class="card">
                <h2>‚ûï Registrar Nuevo Profesor</h2>
                <form id="formProfesor" onsubmit="registrarProfesor(event)">
                    
                    <div class="form-group">
                        <label>DNI *</label>
                        <input type="text" name="dni" required 
                               pattern="[0-9]{8}" maxlength="8"
                               placeholder="12345678">
                    </div>

                    <div class="form-group">
                        <label>Nombres *</label>
                        <input type="text" name="nombres" required 
                               placeholder="Juan Carlos">
                    </div>

                    <div class="form-group">
                        <label>Apellidos *</label>
                        <input type="text" name="apellidos" required 
                               placeholder="P√©rez Garc√≠a">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Celular</label>
                            <input type="tel" name="celular" 
                                   placeholder="987654321">
                        </div>

                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" name="email" 
                                   placeholder="profesor@ist.edu.pe">
                        </div>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" name="tiene_discapacidad" id="tiene_discapacidad">
                        <label for="tiene_discapacidad">Tiene discapacidad</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" name="requiere_aula_accesible" id="requiere_aula_accesible">
                        <label for="requiere_aula_accesible">Requiere aula accesible</label>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Registrar Profesor
                    </button>
                </form>
            </div>

            <!-- Lista de Profesores -->
            <div class="card">
                <h2>üìã Profesores Registrados</h2>
                <div class="table-container">
                    <table id="tablaProfesores">
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Nombre Completo</th>
                                <th>DNI</th>
                                <th>Celular</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="listaProfesores">
                            <tr>
                                <td colspan="6" style="text-align: center; color: #94a3b8;">
                                    Cargando...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
// Cambiar tabs
function cambiarTab(tab) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById(`tab-${tab}`).classList.add('active');
    
    if (tab === 'aulas') {
        cargarAulas();
    } else {
        cargarProfesores();
    }
}

// AULAS
async function registrarAula(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    
    const data = {
        codigo_aula: formData.get('codigo_aula'),
        nombre: formData.get('nombre'),
        piso: parseInt(formData.get('piso')),
        edificio: formData.get('edificio'),
        capacidad_maxima: parseInt(formData.get('capacidad_maxima')),
        proceso_admision: formData.get('proceso_admision'),
        tiene_rampa: formData.get('tiene_rampa') === 'on',
        tiene_ascensor: formData.get('tiene_ascensor') === 'on',
        piso_accesible: formData.get('piso_accesible') === 'on'
    };
    
    try {
        const response = await fetch('/api/aulas/registrar', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('‚úÖ Aula registrada exitosamente');
            form.reset();
            cargarAulas();
        } else {
            alert('‚ùå Error: ' + result.message);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al registrar aula');
    }
}

async function cargarAulas() {
    try {
        const response = await fetch('/api/aulas/listar');
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('totalAulas').textContent = data.total;
            document.getElementById('capacidadTotal').textContent = data.capacidad_total;
            document.getElementById('aulasActivas').textContent = data.activas;
            
            const tbody = document.getElementById('listaAulas');
            tbody.innerHTML = '';
            
            data.aulas.forEach(aula => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${aula.codigo_aula}</strong></td>
                    <td>${aula.nombre}</td>
                    <td>Piso ${aula.piso} - ${aula.edificio || 'N/A'}</td>
                    <td>${aula.capacidad_ocupada}/${aula.capacidad_maxima}</td>
                    <td>
                        <span class="badge ${aula.activa ? 'badge-success' : 'badge-danger'}">
                            ${aula.activa ? 'Activa' : 'Inactiva'}
                        </span>
                    </td>
                    <td class="action-btns">
                        <button class="btn-icon" onclick="editarAula(${aula.id})" title="Editar">‚úèÔ∏è</button>
                        <button class="btn-icon" onclick="eliminarAula(${aula.id})" title="Eliminar">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
    } catch (error) {
        console.error('Error:', error);
    }
}

// PROFESORES
async function registrarProfesor(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    
    const data = {
        dni: formData.get('dni'),
        nombres: formData.get('nombres'),
        apellidos: formData.get('apellidos'),
        celular: formData.get('celular'),
        email: formData.get('email'),
        tiene_discapacidad: formData.get('tiene_discapacidad') === 'on',
        requiere_aula_accesible: formData.get('requiere_aula_accesible') === 'on'
    };
    
    try {
        const response = await fetch('/api/profesores/registrar', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('‚úÖ Profesor registrado exitosamente\nC√≥digo: ' + result.codigo_profesor);
            form.reset();
            cargarProfesores();
        } else {
            alert('‚ùå Error: ' + result.message);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al registrar profesor');
    }
}

async function cargarProfesores() {
    try {
        const response = await fetch('/api/profesores/listar');
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('totalProfesores').textContent = data.total;
            document.getElementById('profesoresActivos').textContent = data.activos;
            document.getElementById('profesoresAsignados').textContent = data.asignados;
            
            const tbody = document.getElementById('listaProfesores');
            tbody.innerHTML = '';
            
            data.profesores.forEach(profesor => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${profesor.codigo_profesor}</strong></td>
                    <td>${profesor.nombres} ${profesor.apellidos}</td>
                    <td>${profesor.dni}</td>
                    <td>${profesor.celular || 'N/A'}</td>
                    <td>
                        <span class="badge ${profesor.activo ? 'badge-success' : 'badge-danger'}">
                            ${profesor.activo ? 'Activo' : 'Inactivo'}
                        </span>
                    </td>
                    <td class="action-btns">
                        <button class="btn-icon" onclick="editarProfesor(${profesor.id})" title="Editar">‚úèÔ∏è</button>
                        <button class="btn-icon" onclick="eliminarProfesor(${profesor.id})" title="Eliminar">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
    } catch (error) {
        console.error('Error:', error);
    }
}

// Cargar al inicio
window.addEventListener('load', () => {
    cargarAulas();
});
</script>
{% endblock %}