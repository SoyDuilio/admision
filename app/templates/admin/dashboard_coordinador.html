<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Coordinador | POSTULANDO</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/admin/base.css">
    <link rel="stylesheet" href="/static/css/admin/dashboard_coordinador.css">
</head>
<body>
    <!-- ============================================================ -->
    <!-- HEADER FIJO -->
    <!-- ============================================================ -->
    <header class="header">
        <div class="header-left">
            <h1>üìä Panel del Coordinador</h1>
            <span>I.S.T. Pedro A. del √Åguila H. | Proceso: {{ proceso_actual }}</span>
        </div>
        <div class="header-right">
            <span class="user-badge">üë§ {{ usuario.nombres }} {{ usuario.apellidos }}</span>
            <a href="/" class="btn-logout">üè† Sistema</a>
            <a href="/admin/logout" class="btn-logout">üö™ Salir</a>
        </div>
    </header>

    <!-- ============================================================ -->
    <!-- NAVEGACI√ìN POR PESTA√ëAS -->
    <!-- ============================================================ -->
    <nav class="tabs-nav">
        <button class="tab-btn active" data-tab="tab-postulantes">
            üë• Postulantes
            <span class="badge" id="badgePostulantes">{{ stats.total_postulantes or 0 }}</span>
        </button>
        <button class="tab-btn" data-tab="tab-aulas">
            üè´ Aulas
            <span class="badge" id="badgeAulas">{{ stats.total_aulas or 0 }}</span>
        </button>
        <button class="tab-btn" data-tab="tab-profesores">
            üë®‚Äçüè´ Profesores
            <span class="badge" id="badgeProfesores">{{ stats.total_profesores or 0 }}</span>
        </button>
        <button class="tab-btn" data-tab="tab-listados">
            üìÑ Listados
        </button>
    </nav>

    <!-- ============================================================ -->
    <!-- CONTENEDOR PRINCIPAL -->
    <!-- ============================================================ -->
    <main class="main-container">
        <div class="container">
            
            <!-- ======================================================== -->
            <!-- TAB: POSTULANTES -->
            <!-- ======================================================== -->
            <div id="tab-postulantes" class="tab-content active">
                
                <!-- Estad√≠sticas r√°pidas -->
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="icon">üë•</div>
                        <div class="value">{{ stats.total_postulantes or 0 }}</div>
                        <div class="label">Total Postulantes</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">‚úÖ</div>
                        <div class="value">{{ stats.postulantes_asignados or 0 }}</div>
                        <div class="label">Con Aula Asignada</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">üìù</div>
                        <div class="value">{{ stats.hojas_procesadas or 0 }}</div>
                        <div class="label">Ex√°menes Procesados</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìù Registrar Postulante</h3>
                        <button class="btn btn-outline" onclick="document.getElementById('seccionCargaMasiva').classList.toggle('hidden')">
                            üì§ Carga Masiva
                        </button>
                    </div>
                    
                    <!-- Formulario de registro individual -->
                    <form id="formPostulante" onsubmit="registrarPostulante(event)" class="form-postulante">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">DNI *</label>
                                <input type="text" name="dni" class="form-control" maxlength="8" pattern="\d{8}" required placeholder="12345678">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nombres *</label>
                                <input type="text" name="nombres" class="form-control" required placeholder="Juan Carlos">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Apellido Paterno *</label>
                                <input type="text" name="apellido_paterno" class="form-control" required placeholder="Garc√≠a">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Apellido Materno *</label>
                                <input type="text" name="apellido_materno" class="form-control" required placeholder="L√≥pez">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Programa Educativo *</label>
                                <select name="programa_educativo" class="form-control" required>
                                    <option value="">-- Seleccione --</option>
                                    {% for programa in programas %}
                                    <option value="{{ programa }}">{{ programa }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-lg">üíæ Registrar Postulante</button>
                            <button type="reset" class="btn btn-outline">üîÑ Limpiar</button>
                        </div>
                    </form>
                    
                    <!-- Secci√≥n de carga masiva (oculta por defecto) -->
                    <div id="seccionCargaMasiva" class="hidden" style="margin-top: 24px; padding-top: 24px; border-top: 2px solid var(--border-light);">
                        <h4 style="margin-bottom: 16px;">üì§ Carga Masiva de Postulantes</h4>
                        <form id="formCargaMasiva" onsubmit="cargarPostulantesMasivo(event)">
                            <div class="upload-zone" id="uploadPostulantes">
                                <input type="file" id="archivoPostulantes" name="archivo" accept=".xlsx,.xls,.csv">
                                <div class="icon">üìÅ</div>
                                <h3>Arrastra tu archivo aqu√≠</h3>
                                <p>o haz clic para seleccionar</p>
                                <div class="upload-formats">
                                    <span class="upload-format">üìä Excel (.xlsx)</span>
                                    <span class="upload-format">üìÑ CSV (.csv)</span>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">üì§ Cargar Archivo</button>
                                <button type="button" class="btn btn-outline" onclick="descargarPlantilla('postulantes')">üì• Descargar Plantilla</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Lista de postulantes -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìã Lista de Postulantes</h3>
                    </div>
                    
                    <!-- Filtros -->
                    <div class="filters-bar">
                        <div class="filter-group">
                            <label>DNI</label>
                            <input type="text" id="filtroDni" class="form-control" placeholder="Buscar DNI..." maxlength="8">
                        </div>
                        <div class="filter-group">
                            <label>Apellidos</label>
                            <input type="text" id="filtroApellidos" class="form-control" placeholder="Buscar apellidos...">
                        </div>
                        <div class="filter-group">
                            <label>Programa</label>
                            <select id="filtroPrograma" class="form-control" onchange="filtrarPostulantes()">
                                <option value="">Todos</option>
                                {% for programa in programas %}
                                <option value="{{ programa }}">{{ programa }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>&nbsp;</label>
                            <button class="btn btn-primary" onclick="filtrarPostulantes()">üîç Buscar</button>
                        </div>
                    </div>
                    
                    <!-- Tabla de postulantes -->
                    <div id="listaPostulantes">
                        <div class="text-center" style="padding: 40px;">
                            <div class="spinner"></div>
                            <p style="margin-top: 10px; color: var(--text-muted);">Cargando postulantes...</p>
                        </div>
                    </div>
                    
                    <!-- Paginaci√≥n -->
                    <div id="paginacionPostulantes"></div>
                </div>
            </div>

            <!-- ======================================================== -->
            <!-- TAB: AULAS -->
            <!-- ======================================================== -->
            <div id="tab-aulas" class="tab-content">
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üè´ Registrar Aula</h3>
                    </div>
                    
                    <!-- Configuraci√≥n de prefijo -->
                    <div class="prefix-config">
                        <label>Prefijo de c√≥digo:</label>
                        <select id="prefijoAula" name="prefijo" class="form-control" style="width: auto;">
                            <option value="AU">AU (AU-001)</option>
                            <option value="A">A (A-001)</option>
                            <option value="AULA">AULA (AULA-001)</option>
                            <option value="S">S (S-001)</option>
                        </select>
                        <span>Siguiente c√≥digo:</span>
                        <span class="prefix-preview" id="previewCodigo">AU-001</span>
                    </div>
                    
                    <form id="formAula" onsubmit="registrarAula(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Nombre del Aula</label>
                                <input type="text" name="nombre" class="form-control" placeholder="Aula Magna, Lab. C√≥mputo 1...">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Programa / Facultad</label>
                                <select name="programa" class="form-control">
                                    <option value="">-- General --</option>
                                    {% for programa in programas %}
                                    <option value="{{ programa }}">{{ programa }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Pabell√≥n / Edificio</label>
                                <input type="text" name="pabellon" class="form-control" placeholder="A, B, Principal...">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Piso</label>
                                <input type="text" name="piso" class="form-control" placeholder="1, 2, 3...">
                            </div>
                            <div class="form-group">
                                <label class="form-label">N√∫mero Original</label>
                                <input type="text" name="numero" class="form-control" placeholder="101, 202...">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Capacidad *</label>
                                <input type="number" name="capacidad" class="form-control" min="1" max="100" required placeholder="30">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-lg">üíæ Registrar Aula</button>
                        </div>
                    </form>
                </div>

                <!-- Lista de aulas -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìã Aulas Registradas</h3>
                    </div>
                    <div id="listaAulas">
                        <div class="text-center" style="padding: 40px;">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ======================================================== -->
            <!-- TAB: PROFESORES -->
            <!-- ======================================================== -->
            <div id="tab-profesores" class="tab-content">
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üë®‚Äçüè´ Registrar Profesor / Vigilante</h3>
                        <button class="btn btn-outline" onclick="document.getElementById('seccionCargaProfesores').classList.toggle('hidden')">
                            üì§ Carga Masiva
                        </button>
                    </div>
                    
                    <form id="formProfesor" onsubmit="registrarProfesor(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">DNI *</label>
                                <input type="text" name="dni" class="form-control" maxlength="8" pattern="\d{8}" required placeholder="12345678">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nombres *</label>
                                <input type="text" name="nombres" class="form-control" required placeholder="Mar√≠a Elena">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Apellido Paterno *</label>
                                <input type="text" name="apellido_paterno" class="form-control" required placeholder="Rodr√≠guez">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Apellido Materno</label>
                                <input type="text" name="apellido_materno" class="form-control" placeholder="S√°nchez">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Condici√≥n *</label>
                                <select name="condicion" class="form-control" required>
                                    <option value="DOCENTE">Docente de la instituci√≥n</option>
                                    <option value="ADMINISTRATIVO">Personal administrativo</option>
                                    <option value="EXTERNO">Externo (contratado)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" name="email" class="form-control" placeholder="correo@ejemplo.com">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tel√©fono</label>
                                <input type="text" name="telefono" class="form-control" placeholder="999888777">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-lg">üíæ Registrar Profesor</button>
                        </div>
                    </form>
                    
                    <!-- Carga masiva de profesores -->
                    <div id="seccionCargaProfesores" class="hidden" style="margin-top: 24px; padding-top: 24px; border-top: 2px solid var(--border-light);">
                        <h4 style="margin-bottom: 16px;">üì§ Carga Masiva de Profesores</h4>
                        <form id="formCargaProfesores" onsubmit="cargarProfesoresMasivo(event)">
                            <div class="upload-zone" id="uploadProfesores">
                                <input type="file" id="archivoProfesores" name="archivo" accept=".xlsx,.xls,.csv">
                                <div class="icon">üìÅ</div>
                                <h3>Arrastra tu archivo aqu√≠</h3>
                                <p>Columnas: DNI, Nombres, Apellidos, Condici√≥n, Email, Tel√©fono</p>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">üì§ Cargar Archivo</button>
                                <button type="button" class="btn btn-outline" onclick="descargarPlantilla('profesores')">üì• Descargar Plantilla</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Lista de profesores -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìã Profesores / Vigilantes Registrados</h3>
                    </div>
                    <div id="listaProfesores">
                        <div class="text-center" style="padding: 40px;">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ======================================================== -->
            <!-- TAB: LISTADOS -->
            <!-- ======================================================== -->
            <div id="tab-listados" class="tab-content">
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìÑ Generar Listados</h3>
                    </div>
                    
                    <div class="listados-options">
                        <div class="listado-option selected" data-listado="alfabetico" onclick="seleccionarTipoListado('alfabetico')">
                            <div class="icon">üìã</div>
                            <h3>Lista Alfab√©tica General</h3>
                            <p>Todos los postulantes ordenados alfab√©ticamente con su aula asignada</p>
                        </div>
                        <div class="listado-option" data-listado="por-aula" onclick="seleccionarTipoListado('por-aula')">
                            <div class="icon">üè´</div>
                            <h3>Lista por Aula</h3>
                            <p>Postulantes de un aula espec√≠fica para control del profesor vigilante</p>
                        </div>
                        <div class="listado-option" data-listado="por-programa" onclick="seleccionarTipoListado('por-programa')">
                            <div class="icon">üìö</div>
                            <h3>Lista por Programa</h3>
                            <p>Postulantes agrupados por programa educativo</p>
                        </div>
                    </div>
                    
                    <!-- Configuraci√≥n adicional para lista por aula -->
                    <div id="config-por-aula" class="hidden" style="margin-top: 20px;">
                        <div class="form-group">
                            <label class="form-label">Seleccione el Aula</label>
                            <select id="listadoAula" class="form-control">
                                <option value="">-- Seleccione --</option>
                                {% for aula in aulas %}
                                <option value="{{ aula.id }}">{{ aula.codigo }} - {{ aula.nombre or 'Sin nombre' }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-actions" style="margin-top: 20px;">
                        <button id="btnGenerarListado" class="btn btn-primary btn-lg" onclick="generarListado(document.querySelector('.listado-option.selected')?.dataset.listado || 'alfabetico')">
                            üìÑ Generar Listado
                        </button>
                        <button class="btn btn-success btn-lg" onclick="imprimirListado()">üñ®Ô∏è Imprimir</button>
                    </div>
                </div>

                <!-- Vista previa del listado -->
                <div class="card hidden" id="previewListadoCard">
                    <div class="card-header">
                        <h3 class="card-title">üëÅÔ∏è Vista Previa</h3>
                        <div>
                            <button class="btn btn-outline" onclick="imprimirListado()">üñ®Ô∏è Imprimir</button>
                            <button class="btn btn-success" onclick="descargarListadoPDF()">üì• Descargar PDF</button>
                        </div>
                    </div>
                    <div id="previewListado" class="listado-preview"></div>
                </div>
            </div>

        </div>
    </main>

    <!-- ============================================================ -->
    <!-- FOOTER FIJO -->
    <!-- ============================================================ -->
    <footer class="footer">
        <div class="footer-stats">
            <div class="footer-stat">
                <span>üë•</span>
                <span>Postulantes:</span>
                <span class="footer-stat-value" id="footerPostulantes">{{ stats.total_postulantes or 0 }}</span>
            </div>
            <div class="footer-stat">
                <span>üè´</span>
                <span>Aulas:</span>
                <span class="footer-stat-value" id="footerAulas">{{ stats.total_aulas or 0 }}</span>
            </div>
            <div class="footer-stat">
                <span>üë®‚Äçüè´</span>
                <span>Profesores:</span>
                <span class="footer-stat-value" id="footerProfesores">{{ stats.total_profesores or 0 }}</span>
            </div>
        </div>
        <div>
            <span>Proceso: <strong>{{ proceso_actual }}</strong></span>
        </div>
    </footer>

    <!-- ============================================================ -->
    <!-- MODALES -->
    <!-- ============================================================ -->
    
    <!-- Modal Editar Postulante -->
    <div id="modalEditarPostulante" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">‚úèÔ∏è Editar Postulante</h3>
                <button class="modal-close" onclick="cerrarModal('modalEditarPostulante')">√ó</button>
            </div>
            <form onsubmit="guardarEdicionPostulante(event)">
                <div class="modal-body">
                    <input type="hidden" id="editId" name="id">
                    <div class="form-group">
                        <label class="form-label">DNI</label>
                        <input type="text" id="editDni" name="dni" class="form-control" maxlength="8" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Nombres</label>
                            <input type="text" id="editNombres" name="nombres" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Apellido Paterno</label>
                            <input type="text" id="editApellidoPaterno" name="apellido_paterno" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Apellido Materno</label>
                            <input type="text" id="editApellidoMaterno" name="apellido_materno" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Programa</label>
                            <select id="editPrograma" name="programa_educativo" class="form-control">
                                {% for programa in programas %}
                                <option value="{{ programa }}">{{ programa }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="cerrarModal('modalEditarPostulante')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">üíæ Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Aula -->
    <div id="modalEditarAula" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">‚úèÔ∏è Editar Aula</h3>
                <button class="modal-close" onclick="cerrarModal('modalEditarAula')">√ó</button>
            </div>
            <form onsubmit="guardarEdicionAula(event)">
                <div class="modal-body">
                    <input type="hidden" id="editAulaId" name="id">
                    <div class="form-group">
                        <label class="form-label">Nombre</label>
                        <input type="text" id="editAulaNombre" name="nombre" class="form-control">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Programa</label>
                            <input type="text" id="editAulaPrograma" name="programa" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pabell√≥n</label>
                            <input type="text" id="editAulaPabellon" name="pabellon" class="form-control">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Piso</label>
                            <input type="text" id="editAulaPiso" name="piso" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">N√∫mero</label>
                            <input type="text" id="editAulaNumero" name="numero" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Capacidad</label>
                            <input type="number" id="editAulaCapacidad" name="capacidad" class="form-control" min="1">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="cerrarModal('modalEditarAula')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">üíæ Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ============================================================ -->
    <!-- SCRIPTS -->
    <!-- ============================================================ -->
    <script src="/static/js/admin/base.js"></script>
    <script src="/static/js/admin/dashboard_coordinador.js"></script>
</body>
</html>