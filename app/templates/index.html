{% extends "base.html" %}

{% block title %}Dashboard - POSTULANDO{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary: #1976d2;
        --success: #4caf50;
        --warning: #ff9800;
        --danger: #f44336;
    }

    body {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        min-height: 100vh;
        margin: 0;
        padding: 0;
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .dashboard-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    /* Top Navigation */
    .top-nav {
        display: flex;
        gap: 12px;
        margin-bottom: 24px;
        flex-wrap: wrap;
    }

    .nav-button {
        padding: 12px 24px;
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        color: white;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
    }

    .nav-button:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: var(--primary);
        transform: translateY(-2px);
    }

    .nav-button.secondary {
        background: linear-gradient(135deg, var(--primary), #1565c0);
        border-color: var(--primary);
    }

    /* Header */
    .page-header {
        text-align: center;
        margin-bottom: 32px;
        padding: 32px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .institution {
        font-size: 32px;
        font-weight: bold;
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 8px;
    }

    .subtitle {
        color: #94a3b8;
        font-size: 16px;
    }

    /* Stats Grid 2x2 */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin-bottom: 32px;
    }

    @media (min-width: 768px) {
        .stats-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }

    .stat-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 24px;
        transition: all 0.3s;
    }

    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(59, 130, 246, 0.2);
    }

    .stat-card-1 { border-top: 4px solid #3b82f6; }
    .stat-card-2 { border-top: 4px solid #8b5cf6; }
    .stat-card-3 { border-top: 4px solid #10b981; }
    .stat-card-4 { border-top: 4px solid #f59e0b; }

    .stat-content {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .stat-icon {
        font-size: 40px;
    }

    .stat-info {
        display: flex;
        flex-direction: column;
    }

    .stat-info .value {
        font-size: 32px;
        font-weight: bold;
        line-height: 1;
        margin-bottom: 4px;
    }

    .stat-info .label {
        font-size: 14px;
        color: #94a3b8;
    }

    /* Section Title */
    .section-title {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 20px;
        color: white;
    }

    /* Process Grid 2x2 */
    .process-section {
        margin-bottom: 32px;
    }

    .process-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
    }

    .process-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 24px;
        text-decoration: none;
        color: white;
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
        display: block;
    }

    .process-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--success));
        opacity: 0;
        transition: opacity 0.3s;
    }

    .process-card:hover {
        transform: translateY(-4px);
        border-color: var(--primary);
        box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
    }

    .process-card:hover::before {
        opacity: 1;
    }

    .process-number {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, var(--primary), #1565c0);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 12px;
    }

    .process-card h3 {
        margin: 0 0 8px 0;
        font-size: 18px;
    }

    .process-card p {
        margin: 0 0 12px 0;
        color: #94a3b8;
        font-size: 14px;
    }

    .process-status {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }

    .status-ready {
        background: rgba(76, 175, 80, 0.2);
        color: #4caf50;
    }

    .status-pending {
        background: rgba(59, 130, 246, 0.2);
        color: #3b82f6;
    }

    /* Videos Grid 2x2 */
    .videos-section {
        margin-bottom: 32px;
    }

    .videos-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
    }

    .video-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        overflow: hidden;
        transition: all 0.3s;
    }

    .video-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(59, 130, 246, 0.2);
    }

    .video-player {
        width: 100%;
        display: block;
        background: black;
    }

    .video-info {
        padding: 16px;
    }

    .video-info h4 {
        margin: 0 0 8px 0;
        font-size: 16px;
    }

    .video-info p {
        margin: 0 0 8px 0;
        color: #94a3b8;
        font-size: 14px;
    }

    .video-duration {
        display: inline-block;
        padding: 4px 8px;
        background: rgba(59, 130, 246, 0.2);
        color: #3b82f6;
        border-radius: 8px;
        font-size: 12px;
        font-weight: 600;
    }

    /* NUEVAS SECCIONES - Gesti√≥n Administrativa */
    .admin-section {
        margin-bottom: 32px;
    }

    .admin-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 16px;
    }

    .admin-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 24px;
        text-decoration: none;
        color: white;
        transition: all 0.3s;
    }

    .admin-card:hover {
        transform: translateY(-4px);
        border-color: var(--primary);
        box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
    }

    .admin-card-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
    }

    .admin-icon {
        font-size: 32px;
    }

    .admin-card h3 {
        margin: 0;
        font-size: 18px;
    }

    .admin-card p {
        color: #94a3b8;
        font-size: 14px;
        margin: 0 0 16px 0;
    }

    .admin-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: rgba(255, 152, 0, 0.2);
        color: #ff9800;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }

    .admin-badge.success {
        background: rgba(76, 175, 80, 0.2);
        color: #4caf50;
    }

    /* Modal Base */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(8px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        padding: 20px;
        overflow-y: auto;
    }

    .modal-overlay.show {
        display: flex;
    }

    /* Modal Container (caja del modal) */
    .modal-container {
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        border: 2px solid rgba(59, 130, 246, 0.3);
        border-radius: 16px;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        width: 100%;
        max-width: 600px;
        max-height: 90vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        animation: modalFadeIn 0.3s ease-out;
    }

    @keyframes modalFadeIn {
        from {
            opacity: 0;
            transform: scale(0.95) translateY(-20px);
        }
        to {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
    }

    /* Modal Header */
    .modal-header {
        background: rgba(59, 130, 246, 0.1);
        border-bottom: 2px solid rgba(59, 130, 246, 0.3);
        padding: 20px 24px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .modal-header h2 {
        color: white;
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0;
    }

    .modal-close {
        background: rgba(239, 68, 68, 0.1);
        border: 2px solid rgba(239, 68, 68, 0.3);
        border-radius: 8px;
        color: #ef4444;
        font-size: 1.5rem;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s;
    }

    .modal-close:hover {
        background: rgba(239, 68, 68, 0.2);
        transform: scale(1.1);
    }

    /* Modal Body */
    .modal-body {
        padding: 24px;
        overflow-y: auto;
        flex: 1;
    }

    /* Botones comunes */
    .btn-cancel {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
    }

    .btn-cancel:hover {
        background: rgba(255, 255, 255, 0.15);
    }

    .btn-primary {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        border: none;
        padding: 12px 32px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 700;
        transition: all 0.3s;
    }

    .btn-primary:hover:not(:disabled) {
        background: linear-gradient(135deg, #059669, #047857);
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(16, 185, 129, 0.4);
    }

    .btn-primary:disabled {
        background: #6b7280;
        cursor: not-allowed;
        opacity: 0.5;
    }

    /* Scrollbar personalizado */
    .modal-body::-webkit-scrollbar {
        width: 8px;
    }

    .modal-body::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 4px;
    }

    .modal-body::-webkit-scrollbar-thumb {
        background: rgba(59, 130, 246, 0.5);
        border-radius: 4px;
    }

    .modal-body::-webkit-scrollbar-thumb:hover {
        background: rgba(59, 130, 246, 0.7);
    }

    /* Responsive */
    @media (max-width: 768px) {
        .modal-container {
            max-width: 95%;
            margin: 10px;
        }
        
        .modal-header h2 {
            font-size: 1.25rem;
        }
        
        .modal-body {
            padding: 16px;
        }
    }

    .modal-content {
        background: white;
        color: #0f172a;
        padding: 48px;
        border-radius: 16px;
        text-align: center;
        max-width: 400px;
    }

    .modal-content h3 {
        margin-bottom: 16px;
    }

    .modal-close {
        padding: 12px 24px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 16px;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .videos-grid,
        .process-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    
    <!-- Navegaci√≥n visible -->
    <div class="top-nav">
        <a href="/" class="nav-button">üè† Inicio</a>
        <a href="/resultados" target="_blank" class="nav-button secondary">üìä Ver Resultados</a>
        <a href="/estadisticas" class="nav-button">üìä Estad√≠sticas</a>
    </div>

    <!-- Header -->
    <div class="page-header">
        <div class="institution">I. S. T. Pedro A. Del √Åguila H.</div>
        <p class="subtitle">Sistema de Admisi√≥n con IA de Visi√≥n Artificial</p>
    </div>

    <!-- Stats Grid 2x2 (Original) -->
    <div class="stats-grid">
        <div class="stat-card stat-card-1">
            <div class="stat-content">
                <div class="stat-icon">üë•</div>
                <div class="stat-info">
                    <span class="value" id="stat-postulantes">{{ stats.total_postulantes or 0 }}</span>
                    <span class="label">Postulantes</span>
                </div>
            </div>
        </div>

        <div class="stat-card stat-card-2">
            <div class="stat-content">
                <div class="stat-icon">üìÑ</div>
                <div class="stat-info">
                    <span class="value" id="stat-procesadas">{{ stats.hojas_procesadas or 0 }}</span>
                    <span class="label">Procesadas</span>
                </div>
            </div>
        </div>

        <div class="stat-card stat-card-3">
            <div class="stat-content">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-info">
                    <span class="value" id="stat-gabarito">{{ stats.respuestas_correctas or 0 }}</span>
                    <span class="label">Gabarito</span>
                </div>
            </div>
        </div>

        <div class="stat-card stat-card-4">
            <div class="stat-content">
                <div class="stat-icon">üéØ</div>
                <div class="stat-info">
                    <span class="value" id="stat-calificados">{{ stats.calificados or 0 }}</span>
                    <span class="label">Calificados</span>
                </div>
            </div>
        </div>
    </div>

    <!-- NUEVA SECCI√ìN: Gesti√≥n Administrativa -->
    <div class="admin-section">
        <h2 class="section-title">‚öôÔ∏è Gesti√≥n Administrativa</h2>
        
        <div class="admin-grid">
            <!-- Registro de Postulantes -->
            <a href="/postulantes/registrar" class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-icon">üìù</div>
                    <h3>Registrar Postulante</h3>
                </div>
                <p>Inscripci√≥n y venta de carpetas</p>
                <span class="admin-badge success">‚úì Disponible</span>
            </a>

            <!-- Lista de Postulantes -->
            <a href="/postulantes/lista" class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-icon">üìã</div>
                    <h3>Lista de Postulantes</h3>
                </div>
                <p>Ver y gestionar postulantes</p>
                <span class="admin-badge success">‚úì Disponible</span>
            </a>

            <!-- Verificaci√≥n MINEDU -->
            <a href="/verificacion/certificados" class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-icon">üîç</div>
                    <h3>Verificaci√≥n MINEDU</h3>
                </div>
                <p>Validar certificados de estudios</p>
                <span class="admin-badge">‚ö†Ô∏è Pendiente</span>
            </a>

            <!-- Gesti√≥n de Aulas y Profesores -->
            <a href="/gestion-aulas-profesores" class="admin-card">
                <div class="admin-card-header">
                    <div class="admin-icon">üè´</div>
                    <h3>Aulas y Profesores</h3>
                </div>
                <p>Configurar aulas y vigilantes</p>
                <span class="admin-badge success">‚úì Disponible</span>
            </a>
        </div>
    </div>

    <!-- Proceso Grid 2x2 (Original) -->
    <div class="process-section">
        <h2 class="section-title">üéØ Proceso de Evaluaci√≥n</h2>
        
        <div class="process-grid">
            <!-- Card 1: Generar Hojas -->
            <div class="process-card card-1" style="display: block;">
                <div class="process-number">1</div>
                <h3>Generar Hojas</h3>
                <p>Por aula o individual</p>
                
                <div style="display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap;">
                    <button onclick="abrirModalHojasAula()" class="process-status status-ready" 
                            style="cursor: pointer; border: none; font-size: 0.85rem;">
                        üì¶ Por Aula
                    </button>
                    <button onclick="abrirModalHojaIndividual()" class="process-status status-pending" 
                            style="cursor: pointer; border: none; font-size: 0.85rem;">
                        üìÑ Individual
                    </button>

                    <button onclick="abrirModalGestion()" class="process-status status-pending" 
                            style="cursor: pointer; border: none; font-size: 0.85rem;">
                        üóëÔ∏è Gesti√≥n de Asignaciones
                    </button>
                </div>
            </div>

            <!-- Card 2: Capturar Ex√°menes -->
            <a href="/capturar-hojas" class="process-card card-2">
                <div class="process-number">2</div>
                <h3>Capturar Ex√°menes</h3>
                <p>Procesa con IA de visi√≥n</p>
                <span class="process-status status-pending">‚ö° Activo</span>
            </a>

            <!-- Card 3: Registrar Gabarito -->
            <a href="/registrar-gabarito" class="process-card card-3">
                <div class="process-number">3</div>
                <h3>Registrar Gabarito</h3>
                <p>Ingresa respuestas correctas</p>
                <span class="process-status status-pending">‚ö° Activo</span>
            </a>

            <!-- Card 4: Ver Resultados -->
            <a href="/resultados" target="_blank" class="process-card card-4">
                <div class="process-number">4</div>
                <h3>Ver Resultados</h3>
                <p>Ranking con estad√≠sticas</p>
                <span class="process-status status-pending">üîú Pr√≥ximo</span>
            </a>
        </div>
    </div>

    <!-- 4 Videos Grid 2x2 (Original) -->
    <div class="videos-section">
        <h2 class="section-title">üé¨ Tutoriales del Sistema</h2>
        
        <div class="videos-grid">
            <!-- Video 1 -->
            <div class="video-card video-1">
                <video class="video-player" controls>
                    <source src="/static/vid/presentacion.mp4" type="video/mp4">
                    Tu navegador no soporta el elemento de video.
                </video>
                <div class="video-info">
                    <h4>Testimonio Institucional</h4>
                    <p>Presentaci√≥n</p>
                    <span class="video-duration">‚è± 8s</span>
                </div>
            </div>

            <!-- Video 2 -->
            <div class="video-card video-2">
                <video class="video-player" controls>
                    <source src="/static/vid/paso-1.mp4" type="video/mp4">
                    Tu navegador no soporta el elemento de video.
                </video>
                <div class="video-info">
                    <h4>Generar Hojas PDF</h4>
                    <p>Pre-procesamiento de im√°genes</p>
                    <span class="video-duration">‚è± 8s</span>
                </div>
            </div>

            <!-- Video 3 -->
            <div class="video-card video-3">
                <video class="video-player" controls>
                    <source src="/static/vid/paso-2.mp4" type="video/mp4">
                    Tu navegador no soporta el elemento de video.
                </video>
                <div class="video-info">
                    <h4>Captura con I.A.</h4>
                    <p>Calificaci√≥n</p>
                    <span class="video-duration">‚è± 8s</span>
                </div>
            </div>

            <!-- Video 4 - Testimonio -->
            <div class="video-card video-4">
                <video class="video-player" controls>
                    <source src="/static/vid/paso-3.mp4" type="video/mp4">
                    Tu navegador no soporta el elemento de video.
                </video>
                <div class="video-info">
                    <h4>Ver Ranking</h4>
                    <p>Transparencia con IA</p>
                    <span class="video-duration">‚è± 8s</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Generaci√≥n de Hojas por Aula -->
    {% include "components/modal_generar_hojas_aula.html" %}
    {% include "components/modal_generar_hoja_individual.html" %}
    {% include "components/modal_confirmar_regeneracion.html" %}
    {% include "components/modal_reversion_asignaciones.html" %}

</div>

<!-- Modal En Desarrollo -->
<div class="modal-overlay" id="modalDesarrollo" style="display: none !important;">
    <div class="modal-content">
        <h3>üöß En Desarrollo</h3>
        <p>Esta funcionalidad estar√° disponible pr√≥ximamente.</p>
        <button class="modal-close" onclick="cerrarModal()">Entendido</button>
    </div>
</div>

<script>
function cerrarModal() {
    document.getElementById('modalDesarrollo').classList.remove('show');
}

// Actualizar estad√≠sticas cada 30 segundos
async function actualizarEstadisticas() {
    try {
        const response = await fetch('/api/dashboard/estadisticas');
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('stat-postulantes').textContent = data.total_postulantes || 0;
            document.getElementById('stat-procesadas').textContent = data.hojas_procesadas || 0;
            document.getElementById('stat-gabarito').textContent = data.gabarito_registrado ? 100 : 0;
            document.getElementById('stat-calificados').textContent = data.hojas_calificadas || 0;
        }
    } catch (error) {
        console.error('Error al actualizar estad√≠sticas:', error);
    }
}

// Cargar estad√≠sticas al inicio
window.addEventListener('load', () => {
    actualizarEstadisticas();
    setInterval(actualizarEstadisticas, 30000); // Cada 30 segundos
});
</script>
{% endblock %}